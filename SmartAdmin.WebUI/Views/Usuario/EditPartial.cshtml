@using SmartAdmin.WebUI.HtmlHelpers;
@model SmartAdmin.Dto.UsuarioDto 

@using (Html.BeginForm("Save", "Usuario", FormMethod.Post, new { @id = "smart-form-edit", @class = "smart-form" }))
{
    @Html.HiddenFor(model => Model.ID, new { id = "ID" })
    @Html.HiddenFor(model => Model.DTH_CRIACAO, new { id = "DTH_CRIACAO" })
    @Html.HiddenFor(model => Model.FOTO, new { id = "FOTO" })
    @Html.HiddenFor(model => Model.FLAG_ADM, new { id = "FLAG_ADM" })
    <fieldset>
        <div class="row">
            <div class="col-sm-3">
                 <img id="start-webcam" @((Model.FOTO == null) ? "src=/Content/img/avatars/sunny-big.png" : "src=" + Model.FOTO + "" )  style="margin: 0px 10px 5px 10px; border: 6px solid #e3e3e3; width: 240px; height:180px;" />
            </div>
            <div class="col-sm-4">           
                <h1>@Model.NOME<br/><small>Usuário Administrador</small></h1>
            </div>
        </div>
    </fieldset>
    <fieldset>
        <div class="row">
            <section class="col col-6">
                <h1>Dados Pessois</h1>
            </section>
        </div>
        <div class="row">
            <section class="col col-6">
                <label class="input">
                    <i class="icon-prepend fa fa-user"></i>
                     @HtmlControls.TextBox("NOME", new { @value = Model.NOME, @placeholder = "Nome completo do usuário", @class="text-uppercase" })
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> Nome completo do usuário
                    </b>
                </label>
            </section>
        </div>
        <div class="row">
            <section class="col col-6">
                <label class="input">
                    <i class="icon-prepend fa fa-envelope-o"></i>
                     @HtmlControls.TextBox("EMAIL", new { @value = Model.EMAIL, @placeholder = "E-mail de contato" })
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> E-mail de contato
                    </b>
                </label>
            </section>
        </div>
        <div class="row">
            <section class="col col-3">
                <label class="input">
                    <i class="icon-prepend fa fa-phone"></i>
                     @HtmlControls.TextBox("TELEFONE", new { @value = Model.TELEFONE, @placeholder = "Telefone de contato", @class="phonemask"  })
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> Informe seu telefone
                    </b>
                </label>
            </section>
            <section class="col col-3">
                <label class="input">
                    <i class="icon-prepend fa fa-phone"></i>
                     @HtmlControls.TextBox("CELULAR", new { @value = Model.CELULAR, @placeholder = "Celular de contato", @class="phonemask" })
                     <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> Informe seu celular
                    </b>
                </label>
            </section>
        </div>
        <div class="row">
            <section class="col col-3">
                <label class="select">
                    @HtmlControls.DropDownListCustomSexo("SEXO",((Model.SEXO != null) ? ((Model.SEXO == "M") ? EInputSexo.M : EInputSexo.F) : EInputSexo.None), false, new { @tabindex = "3" })
                    <i></i>
                </label>
            </section>
            <section class="col col-3">
                <label class="input">
                    <i class="icon-prepend fa fa-user"></i>
                    @HtmlControls.TextBox("CPF_CNPJ", new { @value = Model.CPF_CNPJ, @placeholder = "Documento Cpf ou Cnpj", @tabindex = "4", @readonly = "true" })
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> Cpf ou Cnpj
                    </b>
                </label>
            </section>
        </div>
    </fieldset>
    <fieldset>
        <div class="row">
            <section class="col col-6">
                <h1>Dados de Endereço</h1>
            </section>
        </div> 
        <div class="row">
            <section class="col col-5">
                <label class="input">
                    @HtmlControls.TextBox("ENDERECO", new { @value = Model.ENDERECO, @placeholder = "Informe seu Endereco" })
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> Informe seu endereço
                    </b>
                </label>
            </section>
            <section class="col col-1">
                <label class="input">
                    @HtmlControls.TextBox("NUMERO", new { @value = Model.NUMERO, @placeholder = "Nº", @class="integer"})
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> Número
                    </b>
                </label>
            </section>
        </div>   
        <div class="row">
            <section class="col col-3">
                <label class="input">
                    @HtmlControls.TextBox("BAIRRO", new { @value = Model.BAIRRO, @placeholder = "Informe seu Bairro" })
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> Informe seu Bairro
                    </b>
                </label>
            </section>  
            <section class="col col-3">
                <label class="input">
                    @HtmlControls.TextBox("CIDADE", new { @value = Model.CIDADE, @placeholder = "Informe sua Cidade" })
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> Informe sua Cidade
                    </b>
                </label>
            </section>
        </div> 
        <div class="row">  
            <section class="col col-3">
                <label class="input">
                    @HtmlControls.TextBox("CEP", new { @value = Model.CEP, @placeholder = "Cep", @class = "cep" })
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i>Informe seu cep
                    </b>
                </label>
            </section>   
            <section class="col col-3">
                <label class="select">
                    @HtmlControls.DropDownListCustomUF("UF",EInputUF.SP)
                    <i></i>
                </label>
            </section>
        </div>
        <div class="row">
            <section class="col col-6">
                <label class="input">
                    @HtmlControls.TextBox("COMPLEMENTO", new { @value = Model.COMPLEMENTO, @placeholder = "Complemento" })
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> Complemento
                    </b>
                </label>
            </section>
        </div>
        <div class="row">
            <section class="col col-3">
                <label class="select">
                    @HtmlControls.DropDownListCustomPais("PAIS", Model.PAIS)
                    <i></i>
                </label>
            </section> 
        </div>
    </fieldset>   
    <fieldset>
        <div class="row">
            <section class="col col-6">
                <h1>Dados de Acesso</h1>
            </section>
        </div>
        <div class="row">
            <section class="col col-3">
                <label class="select">
                     @HtmlControls.DropDownListCustomStatus("STATUS", ((Model.STATUS == "A") ? EInputStatus.Ativo : EInputStatus.Inativo))
                    <i></i>
                </label>
            </section>
        </div>
        <div class="row">
            <section class="col col-3">
                <label class="input">
                    <i class="icon-prepend fa fa-user"></i>
                    @HtmlControls.TextBox("LOGIN", new { @value = Model.LOGIN, @placeholder = "Usuário de acesso", @readonly="true" })
                </label>
            </section>
        </div>
        <div class="row">
            <section class="col col-3">
                <label class="input">                    
                    <i class="icon-prepend fa fa-lock"></i>
                    @HtmlControls.Password("SENHA", new { @value = string.Empty, @placeholder = "Senha de acesso" })
                    <div class="note">
                        <strong>Nota:</strong> Para alterar a senha basta inserir uma outra senha neste campo.
                    </div>
                    <b class="tooltip tooltip-bottom-right">
                        <i class="fa fa-warning txt-color-teal"></i> Senha de acesso
                    </b>
                </label>
            </section>
        </div>
    </fieldset>      
    <fieldset>
        <div class="row">
            <section class="col col-6">
                <h1>Configurações Avançadas</h1>
            </section>
        </div>
        <div class="row">
            <section class="col col-4">
                <label class="toggle">
                    <input id="config-adm" type="checkbox" name="checkbox-toggle" @((Model.FLAG_ADM == "S" ? "checked=checked" : string.Empty))>
                    <i data-swchon-text="SIM" data-swchoff-text="NÃO"></i> É um Administrador do Sistema ?   
                </label>
            </section>
        </div>
    </fieldset>
    <footer>
        <button id="btnSaveUsuario" type="submit" class="btn btn-warning">
            Salvar
        </button>
        <a href="/Usuario/Index" class="btn btn-primary">
            Voltar
        </a>
    </footer>
} 

<div id="modal-webcam" class="modal fade" role="dialog" aria-labelledby="modal-webcam">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" id="closeWebcam" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="gridSystemModalLabel">Foto de Perfil</h4>
      </div>
      <div class="modal-body">
          <div class="container-fluid">
              <div class="row">
                  <div class="col-md-6 text-center" style="padding:0px 4px 10px 0px;">
                      <div id="action-buttons" class="btn-group btn-group-justified">
                          <div class="btn-group">
                              <button type="button" class="btn btn-default" id="take-snapshot"><i class="fa fa-video-camera"></i></button>
                          </div>
                          <div class="btn-group">
                              <button type="button" class="btn btn-default" id="take-clear">Limpar</button>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="row">
                  <div class="col-md-6 text-center" style="padding-left: 0px;">
                      <div id="say-cheese-container"></div>
                      <div class="note">
                          <strong>Nota</strong> Stream de video da Webcam.
                      </div>
                      <h5 style="color:#76A053;"><i class="fa fa-video-camera"></i> Webcam Integrada</h5>
                  </div>
                  <div class="col-md-6 text-center" style="padding-left: 5px;">
                      <div id="say-cheese-container-snapshots">
                          @*
                          <div id="say-cheese-snapshots"></div>
                          <div class="note" style="margin-top: 10px;">
                              <strong>Nota</strong> Imagem para o Perfil.
                          </div>
                          <h5 style="color:#76A053;"><i class="fa fa-video-camera"></i> Foto de Perfil</h5>
                          *@
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" id="modal-voltar">Voltar</button>
        <button type="button" class="btn btn-warning" id="modal-salvar">Salvar</button>
      </div>
    </div>
  </div>
</div>

<script src="~/Content/js/plugin/jquery-webcam/jquery-webcam.js"></script>
<script>

    $(document).ready(function () {

        $('#modal-salvar').click(function () {
            var ByteImg = $('#picture').attr("src");
            $('#start-webcam').attr("src", ByteImg);
            $('#FOTO').attr("value", ByteImg);
            $('#modal-webcam').modal('hide');

            $('#say-cheese-container').empty();
            $('#say-cheese-snapshots').empty();
        });

        $('#start-webcam').click(function () {              
            InitWebcam();
            $('#say-cheese-container-snapshots').empty();
            $('#modal-webcam').modal('show');
        });

        $('#take-clear').click(function () {
            $('#say-cheese-container-snapshots').empty();
        });

        $('#config-adm').click(function () {
            var check = $(this).is(":checked");
            if (check == true) { $('#FLAG_ADM').val("S"); }
            else { $('#FLAG_ADM').val("N"); }
        });   

        function InitWebcam() {
            var ControlWidth = 275;

            $(function () {
                var sayCheese = new SayCheese('#say-cheese-container', { snapshots: true, audio: false, width: ControlWidth });

                sayCheese.on('start', function () {
                    $('#action-buttons').fadeIn('fast');
                    $('#say-cheese-container-snapshots').empty();

                    $('#take-snapshot').on('click', function (evt) {
                        sayCheese.takeSnapshot();
                    });
                });

                sayCheese.on('off', function () { 
                    $('#closeWebcam').on('click', function (evt) {
                        sayCheese.off();
                    });

                    $('#modal-voltar').on('click', function (evt) {
                        sayCheese.off();
                     });
                });

                $('#closeWebcam, #modal-voltar').on('click', function () {
                    sayCheese.stop();
                    $('#say-cheese-container').empty();
                    $('#say-cheese-snapshots').empty();
                });

                sayCheese.on('error', function (error) {
                    var $alert = $('<div>');
                    $alert.addClass('alert alert-error').css('margin-top', '20px');
                    if (error === 'NOT_SUPPORTED') {
                        $alert.html("<strong>:(</strong> Seu navegador não suporta vídeo ainda!");
                    } else if (error === 'AUDIO_NOT_SUPPORTED') {
                        $alert.html("<strong>:(</strong> Seu navegador não suporta áudio ainda!");
                    } else {
                        $alert.html("<strong>:(</strong> Você tem que clicar em 'permitir' para tentar novamente!");
                    } $('.say-cheese').prepend($alert);
                });

                sayCheese.on('snapshot', function (snapshot) {                      

                    var HtmlCtrl = "<div id='say-cheese-snapshots'></div><div class='note' style='margin-top: 10px;'><strong>Nota</strong> Imagem para o Perfil.</div><h5 style='color:#76A053;'><i class='fa fa-video-camera'></i> Foto de Perfil</h5>";
                    $('#say-cheese-container-snapshots').html(HtmlCtrl);

                    var img = document.createElement('img');
                    img.setAttribute('id', 'picture');

                    $(img).on('load', function () {
                        $('#say-cheese-snapshots').empty();
                        $('#say-cheese-snapshots').prepend(img);
                    });

                    img.src = snapshot.toDataURL('image/png');
                    img.width = ControlWidth;
                });
      
                sayCheese.start();
            });
        }
    });
</script>